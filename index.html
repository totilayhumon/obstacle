<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <title>Obstacle Avoidance Game</title>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: false">
        <!-- Player -->
        <a-box id="player" 
               position="0 1 0" 
               color="blue" 
               width="0.5" 
               height="1" 
               depth="0.5">
        </a-box>
        
        <!-- Ground -->
        <a-plane position="0 0 0" 
                 rotation="-90 0 0" 
                 width="50" 
                 height="100" 
                 color="green"
                 repeat="10 20">
        </a-plane>
        
        <!-- Camera follows player -->
        <a-camera id="camera" 
                  position="0 3 5" 
                  look-at="#player">
        </a-camera>
        
        <!-- Score Display -->
        <a-text id="scoreText" 
                position="-2 4 3" 
                value="Score: 0" 
                color="black"
                scale="1.5 1.5 1.5">
        </a-text>
        
        <!-- Game Over Screen (hidden initially) -->
        <a-text id="gameOverText" 
                position="0 3 2" 
                value="" 
                color="red"
                scale="2 2 2"
                visible="false">
        </a-text>
        
        <a-text id="finalScoreText" 
                position="0 2.5 2" 
                value="" 
                color="red"
                scale="1.5 1.5 1.5"
                visible="false">
        </a-text>
        
        <a-text id="restartText" 
                position="0 2 2" 
                value="Press R to Restart" 
                color="white"
                scale="1.2 1.2 1.2"
                visible="false">
        </a-text>

        <!-- Instructions -->
        <a-text id="instructionsText" 
                position="0 1.5 2" 
                value="A/D: Move Left/Right | W/Space: Jump | S: Crouch" 
                color="yellow"
                scale="1 1 1">
        </a-text>
    </a-scene>

    <script>
        // Wait for A-Frame to fully load
        document.addEventListener('DOMContentLoaded', function() {
            // Game variables
            let score = 0;
            let gameRunning = false;
            let obstacles = [];
            let playerSpeed = 0.1;
            let obstacleSpeed = 0.1;
            let scoreInterval;
            let obstacleInterval;
            let gameLoopInterval;
            
            // Player variables
            let player = document.getElementById('player');
            let camera = document.getElementById('camera');
            let isJumping = false;
            let isCrouching = false;
            let playerX = 0;
            let playerY = 1;
            let playerZ = 0;
            
            // Movement keys
            let keys = {
                left: false,
                right: false,
                jump: false,
                crouch: false
            };
            
            // Get text elements
            let scoreText = document.getElementById('scoreText');
            let gameOverText = document.getElementById('gameOverText');
            let finalScoreText = document.getElementById('finalScoreText');
            let restartText = document.getElementById('restartText');
            let instructionsText = document.getElementById('instructionsText');
            
            // Start the game
            function startGame() {
                console.log('Starting game...');
                score = 0;
                gameRunning = true;
                obstacles = [];
                playerSpeed = 0.1;
                obstacleSpeed = 0.1;
                
                // Reset player position
                playerX = 0;
                playerY = 1;
                playerZ = 0;
                player.setAttribute('position', `${playerX} ${playerY} ${playerZ}`);
                player.setAttribute('height', '1');
                camera.setAttribute('position', `${playerX} 3 5`);
                
                // Hide game over screen
                gameOverText.setAttribute('visible', false);
                finalScoreText.setAttribute('visible', false);
                restartText.setAttribute('visible', false);
                instructionsText.setAttribute('visible', true);
                
                // Reset player state
                isJumping = false;
                isCrouching = false;
                keys = { left: false, right: false, jump: false, crouch: false };
                
                // Clear any existing intervals
                if (scoreInterval) clearInterval(scoreInterval);
                if (obstacleInterval) clearInterval(obstacleInterval);
                if (gameLoopInterval) clearInterval(gameLoopInterval);
                
                // Start score counter
                scoreInterval = setInterval(() => {
                    if (gameRunning) {
                        score += 10;
                        scoreText.setAttribute('value', 'Score: ' + score);
                        // Increase difficulty over time
                        playerSpeed = Math.min(0.15, 0.1 + score * 0.00002);
                        obstacleSpeed = Math.min(0.2, 0.1 + score * 0.00003);
                    }
                }, 100);
                
                // Start spawning obstacles
                obstacleInterval = setInterval(spawnObstacle, 2000);
                
                // Start game loop
                gameLoopInterval = setInterval(updateGame, 16); // ~60fps
            }
            
            // Spawn obstacles ahead of player
            function spawnObstacle() {
                if (!gameRunning) return;
                
                let obstacle = document.createElement('a-box');
                let xPos = (Math.random() - 0.5) * 8; // Random x position (-4 to 4)
                let zPos = playerZ - 20; // Spawn ahead of player
                
                obstacle.setAttribute('position', `${xPos} 1 ${zPos}`);
                obstacle.setAttribute('color', 'red');
                obstacle.setAttribute('width', '1');
                obstacle.setAttribute('height', '2');
                obstacle.setAttribute('depth', '1');
                obstacle.setAttribute('class', 'obstacle');
                
                document.querySelector('a-scene').appendChild(obstacle);
                obstacles.push(obstacle);
            }
            
            // Update game logic
            function updateGame() {
                if (!gameRunning) return;
                
                // Move player forward automatically
                playerZ -= playerSpeed;
                
                // Handle left/right movement
                if (keys.left && playerX > -4) {
                    playerX -= 0.1;
                }
                if (keys.right && playerX < 4) {
                    playerX += 0.1;
                }
                
                // Update player position
                player.setAttribute('position', `${playerX} ${playerY} ${playerZ}`);
                
                // Update camera to follow player
                camera.setAttribute('position', `${playerX} 3 ${playerZ + 5}`);
                camera.setAttribute('look-at', `${playerX} ${playerY} ${playerZ}`);
                
                // Update score position to stay in view
                scoreText.setAttribute('position', `${playerX - 2} 4 ${playerZ - 2}`);
                
                // Update obstacles and check collisions
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    let obstacle = obstacles[i];
                    if (!obstacle || !obstacle.parentNode) {
                        obstacles.splice(i, 1);
                        continue;
                    }
                    
                    let pos = obstacle.getAttribute('position');
                    if (!pos) continue;
                    
                    // Remove obstacles that are far behind player
                    if (pos.z > playerZ + 10) {
                        obstacle.remove();
                        obstacles.splice(i, 1);
                        continue;
                    }
                    
                    // Check collision
                    if (Math.abs(pos.x - playerX) < 0.8 && 
                        Math.abs(pos.z - playerZ) < 0.8 &&
                        Math.abs(pos.y - playerY) < 1) {
                        gameOver();
                        return;
                    }
                }
            }
            
            // Game over function
            function gameOver() {
                console.log('Game Over! Final Score:', score);
                gameRunning = false;
                
                // Clear intervals
                if (scoreInterval) clearInterval(scoreInterval);
                if (obstacleInterval) clearInterval(obstacleInterval);
                if (gameLoopInterval) clearInterval(gameLoopInterval);
                
                // Position game over screen in front of camera
                gameOverText.setAttribute('position', `${playerX} 3 ${playerZ - 3}`);
                finalScoreText.setAttribute('position', `${playerX} 2.5 ${playerZ - 3}`);
                restartText.setAttribute('position', `${playerX} 2 ${playerZ - 3}`);
                
                // Hide instructions
                instructionsText.setAttribute('visible', false);
                
                // Show game over screen
                gameOverText.setAttribute('value', 'GAME OVER!');
                gameOverText.setAttribute('visible', true);
                finalScoreText.setAttribute('value', 'Final Score: ' + score);
                finalScoreText.setAttribute('visible', true);
                restartText.setAttribute('visible', true);
            }
            
            // Keyboard controls
            document.addEventListener('keydown', (event) => {
                // Prevent default behavior for game keys
                if (['Space', 'KeyW', 'KeyS', 'KeyA', 'KeyD', 'KeyR'].includes(event.code)) {
                    event.preventDefault();
                }
                
                if (!gameRunning && event.key.toLowerCase() === 'r') {
                    // Remove all obstacles
                    obstacles.forEach(obstacle => {
                        if (obstacle && obstacle.parentNode) {
                            obstacle.remove();
                        }
                    });
                    obstacles = [];
                    startGame();
                    return;
                }
                
                if (!gameRunning) return;
                
                // Movement keys
                if (event.key.toLowerCase() === 'a') keys.left = true;
                if (event.key.toLowerCase() === 'd') keys.right = true;
                
                // Jump (Space or W key)
                if ((event.code === 'Space' || event.key.toLowerCase() === 'w') && !isJumping && !isCrouching) {
                    isJumping = true;
                    playerY = 2.5; // jump height
                    
                    setTimeout(() => {
                        if (gameRunning && isJumping) {
                            playerY = 1;
                            isJumping = false;
                        }
                    }, 600); // jump duration
                }
                
                // Crouch (S key)
                if (event.key.toLowerCase() === 's' && !isJumping && !isCrouching) {
                    isCrouching = true;
                    playerY = 0.3;
                    player.setAttribute('height', '0.6');
                }
            });
            
            document.addEventListener('keyup', (event) => {
                // Movement keys
                if (event.key.toLowerCase() === 'a') keys.left = false;
                if (event.key.toLowerCase() === 'd') keys.right = false;
                
                // Stop crouching
                if (event.key.toLowerCase() === 's' && isCrouching && !isJumping) {
                    isCrouching = false;
                    playerY = 1;
                    player.setAttribute('height', '1');
                }
            });
            
            // Wait for scene to load, then start game
            let scene = document.querySelector('a-scene');
            if (scene.hasLoaded) {
                setTimeout(startGame, 1000);
            } else {
                scene.addEventListener('loaded', () => {
                    setTimeout(startGame, 1000);
                });
            }
        });
    </script>
</body>
</html>


